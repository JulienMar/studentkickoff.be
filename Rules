#!/usr/bin/env ruby

preprocess do
  jaren.each do |item|
    jaar = item.identifier.without_ext.split('/').last.to_i
    item[:jaar] = jaar
  end

  artists.each do |artist|
    artist[:start] = DateTime.parse(artist[:start])
    artist[:title] = artist[:name]
    puts artist[:title]
  end
end

compile '/**/*.erb' do
  layout '/default.*'
  filter :erb
end

compile '/meetthecrew/*.md' do
  filter :kramdown
  layout '/teampagina.*'
  layout '/default.*'
  filter :erb

  ident = item.identifier.without_ext.split('/').last
  write "/meetthecrew/#{ident}/index.html"
end

compile '/faq.md' do
  filter :kramdown
  layout '/faq.*'
  layout '/default.*'
  filter :erb
end

compile '/partners.erb' do
  filter :kramdown
  layout '/default.*'
  filter :erb
end

compile '/artists/*.md' do
  filter :kramdown
  layout '/artist_page.*'
  layout '/default.*'
  filter :erb
end

compile '/assets/images/gallery/*.{jpg,png}', rep: :thumbnail do
  filter :resize
  write "#{item.identifier.without_ext}_thumbnail.jpg"
end

# Empty route block prevents item from being written out
route '/historiek/*.md' do; end

route '/**/*.{erb,html,md}' do
  if item.identifier =~ '/index.*'
    '/index.html'
  else
    "#{item.identifier.without_ext}/index.html"
  end
end

compile '/**/*.scss' do
  filter :sass, syntax: :scss
  write "#{item.identifier.without_ext}.css"
end

compile '/**/*.coffee' do
  filter :coffeescript
  write "#{item.identifier.without_ext}.js"
end

compile '/**/*' do
  write item.identifier.to_s
end


layout '/**/*', :erb
